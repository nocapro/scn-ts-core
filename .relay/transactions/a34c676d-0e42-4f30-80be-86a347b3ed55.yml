uuid: a34c676d-0e42-4f30-80be-86a347b3ed55
projectId: scn-ts-core
createdAt: '2025-09-04T16:17:09.836Z'
linesAdded: 139
linesRemoved: 36
gitCommitMsg: 'refactor(web-demo): implement cohesive UI/UX overhaul'
promptSummary: Make the UX of the scn-ts-web-demo super cohesive.
reasoning:
  - >-
    Yo, it's anton. Let's get this web demo looking slick and cohesive. We're
    going full shadcn-inspired theme with CSS variables, cleaning up the layout
    with some flexbox magic, and polishing the components. It's gonna be tight.
  - '### Step 1: Establish a Cohesive Theme'
  - >-
    First, I'm setting up a design system using CSS variables in `index.css` for
    light and dark modes. This will be the foundation for all component styling.
    The `tailwind.config.js` will be updated to reference these variables,
    making our theme available via standard Tailwind classes. I'll also update
    the scrollbar to match the new theme.
  - '### Step 2: Update UI Components'
  - >-
    With the theme foundation in place, I'll refactor the UI components
    (`Button`, `Card`, `Textarea`) to use the new semantic color classes. This
    ensures they'll automatically adapt to light/dark mode and maintain a
    consistent look. I'm also bumping up the padding in cards for better
    whitespace.
  - '### Step 3: Enhance the Log Viewer'
  - >-
    The `LogViewer` is getting a UX boost. I'm adding auto-scrolling so the
    latest logs are always visible, displaying timestamps for context, and
    improving the text contrast and layout for better readability. It's now a
    much more useful debugging tool.
  - '### Step 4: Revamp the App Layout'
  - >-
    Finally, I'm overhauling the main `App.tsx` layout. I'm swapping the
    brittle, fixed-height structure for a robust, full-height flexbox layout.
    This makes the UI cleaner and more responsive. The header and footer now
    have subtle borders to delineate sections, and typography has been tightened
    up for a more polished feel. I'm also removing the now-redundant styling
    from `index.html`.
  - '---'
operations:
  - type: write
    path: packages/scn-ts-web-demo/src/index.css
    content: |-
      @tailwind base;
      @tailwind components;
      @tailwind utilities;

      @layer base {
        :root {
          --background: 0 0% 100%;
          --foreground: 222.2 84% 4.9%;
          --card: 0 0% 100%;
          --card-foreground: 222.2 84% 4.9%;
          --popover: 0 0% 100%;
          --popover-foreground: 222.2 84% 4.9%;
          --primary: 222.2 47.4% 11.2%;
          --primary-foreground: 210 40% 98%;
          --secondary: 210 40% 96.1%;
          --secondary-foreground: 215.4 16.3% 46.9%;
          --muted: 210 40% 96.1%;
          --muted-foreground: 215.4 16.3% 46.9%;
          --accent: 210 40% 96.1%;
          --accent-foreground: 222.2 47.4% 11.2%;
          --destructive: 0 84.2% 60.2%;
          --destructive-foreground: 210 40% 98%;
          --border: 214.3 31.8% 91.4%;
          --input: 214.3 31.8% 91.4%;
          --ring: 222.2 84% 4.9%;
          --radius: 0.5rem;
        }

        .dark {
          --background: 222.2 84% 4.9%;
          --foreground: 210 40% 98%;
          --card: 222.2 84% 4.9%;
          --card-foreground: 210 40% 98%;
          --popover: 222.2 84% 4.9%;
          --popover-foreground: 210 40% 98%;
          --primary: 210 40% 98%;
          --primary-foreground: 222.2 47.4% 11.2%;
          --secondary: 217.2 32.6% 17.5%;
          --secondary-foreground: 210 40% 98%;
          --muted: 217.2 32.6% 17.5%;
          --muted-foreground: 215 20.2% 65.1%;
          --accent: 217.2 32.6% 17.5%;
          --accent-foreground: 210 40% 98%;
          --destructive: 0 62.8% 30.6%;
          --destructive-foreground: 210 40% 98%;
          --border: 217.2 32.6% 17.5%;
          --input: 217.2 32.6% 17.5%;
          --ring: 212.7 26.8% 83.9%;
        }
      }

      @layer base {
        * {
          @apply border-border;
        }
        body {
          @apply bg-background text-foreground;
        }
      }

      /* For custom scrollbars */
      ::-webkit-scrollbar {
        width: 8px;
        height: 8px;
      }
      ::-webkit-scrollbar-track {
        background: transparent;
      }
      ::-webkit-scrollbar-thumb {
        background: hsl(var(--border));
        border-radius: 4px;
      }
      ::-webkit-scrollbar-thumb:hover {
        background: hsl(var(--accent-foreground));
      }
    patchStrategy: replace
  - type: write
    path: packages/scn-ts-web-demo/tailwind.config.js
    content: |-
      /** @type {import('tailwindcss').Config} */
      export default {
        darkMode: "class",
        content: [
          "./index.html",
          "./src/**/*.{js,ts,jsx,tsx}",
        ],
        theme: {
          extend: {
            colors: {
              border: "hsl(var(--border))",
              input: "hsl(var(--input))",
              ring: "hsl(var(--ring))",
              background: "hsl(var(--background))",
              foreground: "hsl(var(--foreground))",
              primary: {
                DEFAULT: "hsl(var(--primary))",
                foreground: "hsl(var(--primary-foreground))",
              },
              secondary: {
                DEFAULT: "hsl(var(--secondary))",
                foreground: "hsl(var(--secondary-foreground))",
              },
              destructive: {
                DEFAULT: "hsl(var(--destructive))",
                foreground: "hsl(var(--destructive-foreground))",
              },
              muted: {
                DEFAULT: "hsl(var(--muted))",
                foreground: "hsl(var(--muted-foreground))",
              },
              accent: {
                DEFAULT: "hsl(var(--accent))",
                foreground: "hsl(var(--accent-foreground))",
              },
              card: {
                DEFAULT: "hsl(var(--card))",
                foreground: "hsl(var(--card-foreground))",
              },
            },
            borderRadius: {
              lg: `var(--radius)`,
              md: `calc(var(--radius) - 2px)`,
              sm: `calc(var(--radius) - 4px)`,
            },
          },
        },
        plugins: [],
      }
    patchStrategy: replace
  - type: write
    path: packages/scn-ts-web-demo/src/components/ui/button.tsx
    content: >-
      --- packages/scn-ts-web-demo/src/components/ui/button.tsx

      +++ packages/scn-ts-web-demo/src/components/ui/button.tsx

      @@ -9,15 +9,14 @@
         {
           variants: {
             variant: {
      -        default: "bg-blue-600 text-primary-foreground hover:bg-blue-700
      text-white",

      +        default: "bg-primary text-primary-foreground
      hover:bg-primary/90",
               destructive:
      -          "bg-red-500 text-destructive-foreground hover:bg-red-600",

      +          "bg-destructive text-destructive-foreground
      hover:bg-destructive/90",
               outline:
                 "border border-input bg-background hover:bg-accent hover:text-accent-foreground",
               secondary:
      -          "bg-gray-200 text-secondary-foreground hover:bg-gray-300
      dark:bg-gray-700 dark:hover:bg-gray-600",

      +          "bg-secondary text-secondary-foreground hover:bg-secondary/80",
               ghost: "hover:bg-accent hover:text-accent-foreground",
               link: "text-primary underline-offset-4 hover:underline",
             },
    patchStrategy: new-unified
  - type: write
    path: packages/scn-ts-web-demo/src/components/ui/card.tsx
    content: >-
      --- packages/scn-ts-web-demo/src/components/ui/card.tsx

      +++ packages/scn-ts-web-demo/src/components/ui/card.tsx

      @@ -6,7 +6,10 @@
       >(({ className, ...props }, ref) => (
         <div
           ref={ref}
      -    className={cn("rounded-lg border bg-white dark:bg-gray-800
      dark:border-gray-700 shadow-sm", className)}

      +    className={cn(

      +      "rounded-lg border bg-card text-card-foreground shadow-sm",

      +      className

      +    )}
           {...props}
         />
       ))
      @@ -17,7 +20,7 @@
         React.HTMLAttributes<HTMLDivElement>
       >(({ className, ...props }, ref) => (
         <div
           ref={ref}
      -    className={cn("flex flex-col space-y-1.5 p-4", className)}

      +    className={cn("flex flex-col space-y-1.5 p-6", className)}
           {...props}
         />
       ))
      @@ -28,12 +31,7 @@
         React.HTMLAttributes<HTMLHeadingElement>
       >(({ className, ...props }, ref) => (
         <h3
           ref={ref}
      -    className={cn(

      -      "text-lg font-semibold leading-none tracking-tight",

      -      className

      -    )}

      +    className={cn("text-lg font-semibold leading-none tracking-tight",
      className)}
           {...props}
         />
       ))
      @@ -43,7 +41,7 @@
         HTMLDivElement,
         React.HTMLAttributes<HTMLDivElement>
       >(({ className, ...props }, ref) => (
      -  <div ref={ref} className={cn("p-4 pt-0", className)} {...props} />

      +  <div ref={ref} className={cn("p-6 pt-0", className)} {...props} />
       ))
       CardContent.displayName = "CardContent"
    patchStrategy: new-unified
  - type: write
    path: packages/scn-ts-web-demo/src/components/ui/textarea.tsx
    content: >-
      --- packages/scn-ts-web-demo/src/components/ui/textarea.tsx

      +++ packages/scn-ts-web-demo/src/components/ui/textarea.tsx

      @@ -9,8 +9,7 @@
           return (
             <textarea
               className={cn(
      -          "flex min-h-[80px] w-full rounded-md border border-input
      bg-transparent px-3 py-2 text-sm ring-offset-background
      placeholder:text-muted-foreground focus-visible:outline-none
      focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2
      disabled:cursor-not-allowed disabled:opacity-50",

      -          "dark:border-gray-600 dark:bg-gray-900",

      +          "flex min-h-[80px] w-full rounded-md border border-input
      bg-background px-3 py-2 text-sm ring-offset-background
      placeholder:text-muted-foreground focus-visible:outline-none
      focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2
      disabled:cursor-not-allowed disabled:opacity-50",
                 className
               )}
               ref={ref}
    patchStrategy: new-unified
  - type: write
    path: packages/scn-ts-web-demo/src/components/LogViewer.tsx
    content: >-
      --- packages/scn-ts-web-demo/src/components/LogViewer.tsx

      +++ packages/scn-ts-web-demo/src/components/LogViewer.tsx

      @@ -1,4 +1,4 @@

      -import React from 'react';

      +import React, { useEffect, useRef } from 'react';
       import type { LogLevel } from 'scn-ts-core';
       import { Card, CardContent, CardHeader, CardTitle } from './ui/card';
       import { cn } from '../lib/utils';
      @@ -16,24 +16,33 @@
       };
       
       const LogViewer: React.FC<{ logs: readonly LogEntry[] }> = ({ logs }) => {
      +  const scrollContainerRef = useRef<HTMLDivElement>(null);

      +

      +  useEffect(() => {

      +    if (scrollContainerRef.current) {

      +      scrollContainerRef.current.scrollTop =
      scrollContainerRef.current.scrollHeight;

      +    }

      +  }, [logs]);

      +
         return (
      -    <Card className="h-full flex flex-col">

      -      <CardHeader>

      +    <Card className="h-full flex flex-col border-0 rounded-none
      bg-transparent">

      +      <CardHeader className="py-3 px-6">
               <CardTitle>Logs</CardTitle>
             </CardHeader>
      -      <CardContent className="flex-grow overflow-auto p-0">

      -        <div className="p-4 font-mono text-xs">

      -          {logs.length === 0 && <p className="text-gray-500">No logs yet.
      Click "Analyze" to start.</p>}

      +      <CardContent ref={scrollContainerRef} className="flex-grow
      overflow-auto p-0">

      +        <div className="p-6 pt-0 font-mono text-xs">

      +          {logs.length === 0 && <p className="text-muted-foreground">No
      logs yet. Click "Analyze" to start.</p>}
                 {logs.map((log, index) => (
                   <div key={index} className="flex items-start">
      -              <span className={cn("font-bold w-12 flex-shrink-0",
      levelColorMap[log.level])}>

      +              <span className="text-muted-foreground/80 mr-4
      flex-shrink-0">

      +                {new Date(log.timestamp).toLocaleTimeString()}

      +              </span>

      +              <span className={cn("font-bold w-14 flex-shrink-0",
      levelColorMap[log.level])}>
                       [{log.level.toUpperCase()}]
                     </span>
      -              <span className="whitespace-pre-wrap
      break-all">{log.message}</span>

      +              <span className="whitespace-pre-wrap break-all
      text-foreground">{log.message}</span>
                   </div>
                 ))}
               </div>
             </CardContent>
           </Card>
         );
       };
    patchStrategy: new-unified
  - type: write
    path: packages/scn-ts-web-demo/index.html
    content: >-
      --- packages/scn-ts-web-demo/index.html

      +++ packages/scn-ts-web-demo/index.html

      @@ -5,7 +5,7 @@
           <meta name="viewport" content="width=device-width, initial-scale=1.0" />
           <title>SCN-TS Web Demo</title>
         </head>
      -  <body class="bg-gray-50 dark:bg-gray-900 text-gray-900
      dark:text-gray-100">

      +  <body>
           <div id="root"></div>
           <script type="module" src="/src/main.tsx"></script>
         </body>
    patchStrategy: new-unified
  - type: write
    path: packages/scn-ts-web-demo/src/App.tsx
    content: >-
      --- packages/scn-ts-web-demo/src/App.tsx

      +++ packages/scn-ts-web-demo/src/App.tsx

      @@ -1,6 +1,6 @@

      -import { useState, useEffect, useCallback } from 'react';

      +import { useState, useEffect, useCallback, useRef } from 'react';
       import {
         initializeParser,
         logger,
      @@ -82,9 +82,9 @@
         }, [filesInput, isInitialized]);
       
         return (
      -    <div className="min-h-screen flex flex-col p-4 gap-4">

      -      <header className="flex-shrink-0 flex items-center
      justify-between">

      -        <h1 className="text-2xl font-bold">SCN-TS Web Demo</h1>

      +    <div className="h-screen w-screen flex flex-col bg-background
      text-foreground">

      +      <header className="flex-shrink-0 flex items-center justify-between
      p-4 border-b">

      +        <h1 className="text-xl font-bold tracking-tight">SCN-TS Web
      Demo</h1>
               <Button onClick={handleAnalyze} disabled={isLoading || !isInitialized} className="w-32 justify-center">
                 {isLoading ? (
                   <>
      @@ -100,29 +100,29 @@
               </Button>
             </header>
       
      -      <main className="flex-grow grid grid-cols-1 lg:grid-cols-2 gap-4
      h-[calc(100vh-150px)]">

      -        <Card className="flex flex-col">

      +      <main className="flex-grow grid grid-cols-1 lg:grid-cols-2 gap-4
      p-4 overflow-hidden">

      +        <Card className="flex flex-col overflow-hidden">
                 <CardHeader>
                   <CardTitle>Input Files (JSON)</CardTitle>
                 </CardHeader>
                 <CardContent className="flex-grow">
                   <Textarea
                     value={filesInput}
                     onChange={(e) => setFilesInput(e.currentTarget.value)}
      -              className="h-full w-full font-mono text-xs"

      +              className="h-full w-full font-mono text-xs resize-none"
                     placeholder="Paste an array of FileContent objects here..."
                   />
                 </CardContent>
               </Card>
       
               <Card className="flex flex-col overflow-hidden">
      -           <CardHeader>

      +          <CardHeader>
                   <CardTitle>Output (SCN)</CardTitle>
                 </CardHeader>
      -          <CardContent className="flex-grow overflow-auto p-0">

      -            <pre className="text-xs whitespace-pre font-mono p-4 h-full
      w-full">

      -              <code>

      +          <CardContent className="flex-grow overflow-auto">

      +            <pre className="text-xs whitespace-pre-wrap font-mono h-full
      w-full">

      +              <code className="h-full w-full">
                       {scnOutput || (isLoading ? "Generating..." : "Output will appear here.")}
                     </code>
                   </pre>
      @@ -130,7 +130,7 @@
               </Card>
             </main>
       
      -      <footer className="flex-shrink-0 h-[150px]">

      +      <footer className="flex-shrink-0 h-[200px] border-t">
               <LogViewer logs={logs} />
             </footer>
           </div>
    patchStrategy: new-unified
snapshot:
  packages/scn-ts-web-demo/src/index.css: |-
    @tailwind base;
    @tailwind components;
    @tailwind utilities;

    /* For custom scrollbars */
    ::-webkit-scrollbar {
      width: 8px;
      height: 8px;
    }
    ::-webkit-scrollbar-track {
      background: transparent;
    }
    ::-webkit-scrollbar-thumb {
      background: #888;
      border-radius: 4px;
    }
    ::-webkit-scrollbar-thumb:hover {
      background: #555;
    }
  packages/scn-ts-web-demo/src/components/ui/button.tsx: |-
    import * as React from "react"
    import { Slot } from "@radix-ui/react-slot"
    import { cva, type VariantProps } from "class-variance-authority"
    import { cn } from "../../lib/utils"

    const buttonVariants = cva(
      "inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",
      {
        variants: {
          variant: {
            default: "bg-blue-600 text-primary-foreground hover:bg-blue-700 text-white",
            destructive:
              "bg-red-500 text-destructive-foreground hover:bg-red-600",
            outline:
              "border border-input bg-background hover:bg-accent hover:text-accent-foreground",
            secondary:
              "bg-gray-200 text-secondary-foreground hover:bg-gray-300 dark:bg-gray-700 dark:hover:bg-gray-600",
            ghost: "hover:bg-accent hover:text-accent-foreground",
            link: "text-primary underline-offset-4 hover:underline",
          },
          size: {
            default: "h-10 px-4 py-2",
            sm: "h-9 rounded-md px-3",
            lg: "h-11 rounded-md px-8",
            icon: "h-10 w-10",
          },
        },
        defaultVariants: {
          variant: "default",
          size: "default",
        },
      }
    )

    export interface ButtonProps
      extends React.ButtonHTMLAttributes<HTMLButtonElement>,
        VariantProps<typeof buttonVariants> {
      asChild?: boolean
    }

    const Button = React.forwardRef<HTMLButtonElement, ButtonProps>(
      ({ className, variant, size, asChild = false, ...props }, ref) => {
        const Comp = asChild ? Slot : "button"
        return (
          <Comp
            className={cn(buttonVariants({ variant, size, className }))}
            ref={ref}
            {...props}
          />
        )
      }
    )
    Button.displayName = "Button"

    export { Button, buttonVariants }
  packages/scn-ts-web-demo/tailwind.config.js: |-
    /** @type {import('tailwindcss').Config} */
    export default {
      darkMode: "class",
      content: [
        "./index.html",
        "./src/**/*.{js,ts,jsx,tsx}",
      ],
      theme: {
        extend: {},
      },
      plugins: [],
    }
  packages/scn-ts-web-demo/src/components/ui/card.tsx: |-
    import * as React from "react"
    import { cn } from "../../lib/utils"

    const Card = React.forwardRef<
      HTMLDivElement,
      React.HTMLAttributes<HTMLDivElement>
    >(({ className, ...props }, ref) => (
      <div
        ref={ref}
        className={cn("rounded-lg border bg-white dark:bg-gray-800 dark:border-gray-700 shadow-sm", className)}
        {...props}
      />
    ))
    Card.displayName = "Card"

    const CardHeader = React.forwardRef<
      HTMLDivElement,
      React.HTMLAttributes<HTMLDivElement>
    >(({ className, ...props }, ref) => (
      <div
        ref={ref}
        className={cn("flex flex-col space-y-1.5 p-4", className)}
        {...props}
      />
    ))
    CardHeader.displayName = "CardHeader"

    const CardTitle = React.forwardRef<
      HTMLParagraphElement,
      React.HTMLAttributes<HTMLHeadingElement>
    >(({ className, ...props }, ref) => (
      <h3
        ref={ref}
        className={cn(
          "text-lg font-semibold leading-none tracking-tight",
          className
        )}
        {...props}
      />
    ))
    CardTitle.displayName = "CardTitle"


    const CardContent = React.forwardRef<
      HTMLDivElement,
      React.HTMLAttributes<HTMLDivElement>
    >(({ className, ...props }, ref) => (
      <div ref={ref} className={cn("p-4 pt-0", className)} {...props} />
    ))
    CardContent.displayName = "CardContent"


    export { Card, CardHeader, CardTitle, CardContent }
  packages/scn-ts-web-demo/src/components/ui/textarea.tsx: |-
    import * as React from "react"
    import { cn } from "../../lib/utils"

    export interface TextareaProps
      extends React.TextareaHTMLAttributes<HTMLTextAreaElement> {}

    const Textarea = React.forwardRef<HTMLTextAreaElement, TextareaProps>(
      ({ className, ...props }, ref) => {
        return (
          <textarea
            className={cn(
              "flex min-h-[80px] w-full rounded-md border border-input bg-transparent px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",
              "dark:border-gray-600 dark:bg-gray-900",
              className
            )}
            ref={ref}
            {...props}
          />
        )
      }
    )
    Textarea.displayName = "Textarea"

    export { Textarea }
  packages/scn-ts-web-demo/src/components/LogViewer.tsx: |
    import React from 'react';
    import type { LogLevel } from 'scn-ts-core';
    import { Card, CardContent, CardHeader, CardTitle } from './ui/card';
    import { cn } from '../lib/utils';

    export interface LogEntry {
      level: Exclude<LogLevel, 'silent'>;
      message: string;
      timestamp: number;
    }

    const levelColorMap: Record<Exclude<LogLevel, 'silent'>, string> = {
      error: 'text-red-500',
      warn: 'text-yellow-500',
      info: 'text-blue-400',
      debug: 'text-gray-500',
    };

    const LogViewer: React.FC<{ logs: readonly LogEntry[] }> = ({ logs }) => {
      return (
        <Card className="h-full flex flex-col">
          <CardHeader>
            <CardTitle>Logs</CardTitle>
          </CardHeader>
          <CardContent className="flex-grow overflow-auto p-0">
            <div className="p-4 font-mono text-xs">
              {logs.length === 0 && <p className="text-gray-500">No logs yet. Click "Analyze" to start.</p>}
              {logs.map((log, index) => (
                <div key={index} className="flex items-start">
                  <span className={cn("font-bold w-12 flex-shrink-0", levelColorMap[log.level])}>
                    [{log.level.toUpperCase()}]
                  </span>
                  <span className="whitespace-pre-wrap break-all">{log.message}</span>
                </div>
              ))}
            </div>
          </CardContent>
        </Card>
      );
    };

    export default LogViewer;
  packages/scn-ts-web-demo/index.html: |-
    <!doctype html>
    <html lang="en" class="dark">
      <head>
        <meta charset="UTF-8" />
        <link rel="icon" type="image/svg+xml" href="/vite.svg" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>SCN-TS Web Demo</title>
      </head>
      <body class="bg-gray-50 dark:bg-gray-900 text-gray-900 dark:text-gray-100">
        <div id="root"></div>
        <script type="module" src="/src/main.tsx"></script>
      </body>
    </html>
  packages/scn-ts-web-demo/src/App.tsx: >
    import { useState, useEffect, useCallback } from 'react';

    import {
      initializeParser,
      logger,
      analyzeProject,
      generateScn,
    } from '../../../index';

    import type { FileContent, LogHandler } from '../../../index';

    import { defaultFilesJSON } from './default-files';

    import { Button } from './components/ui/button';

    import { Card, CardContent, CardHeader, CardTitle } from
    './components/ui/card';

    import { Textarea } from './components/ui/textarea';

    import LogViewer from './components/LogViewer';

    import type { LogEntry } from './components/LogViewer';

    import { Play, Loader } from 'lucide-react';


    function App() {
      const [isInitialized, setIsInitialized] = useState(false);
      const [isLoading, setIsLoading] = useState(false);
      const [filesInput, setFilesInput] = useState(defaultFilesJSON);
      const [scnOutput, setScnOutput] = useState('');
      const [progress, setProgress] = useState<{ percentage: number; message: string } | null>(null);
      const [logs, setLogs] = useState<LogEntry[]>([]);

      useEffect(() => {
        const init = async () => {
          try {
            await initializeParser({ wasmBaseUrl: '/wasm/' });
            setIsInitialized(true);
            setLogs(prev => [...prev, { level: 'info', message: 'Parser initialized.', timestamp: Date.now() }]);
          } catch (error) {
            const message = error instanceof Error ? error.message : String(error);
            setLogs(prev => [...prev, { level: 'error', message: `Failed to initialize parser: ${message}`, timestamp: Date.now() }]);
          }
        };
        init();
      }, []);

      const handleAnalyze = useCallback(async () => {
        if (!isInitialized) {
          setLogs(prev => [...prev, { level: 'warn', message: 'Parser not ready.', timestamp: Date.now() }]);
          return;
        }

        setIsLoading(true);
        setLogs([]);
        setScnOutput('');
        setProgress(null);

        const logHandler: LogHandler = (level, ...args) => {
          const message = args.map(arg => typeof arg === 'object' ? JSON.stringify(arg) : String(arg)).join(' ');
          setLogs(prev => [...prev, { level, message, timestamp: Date.now() }]);
        };
        logger.setLogHandler(logHandler);
        logger.setLevel('debug');

        const onProgress = (progressData: { percentage: number; message: string }) => {
          setProgress(progressData);
          logger.info(`[${Math.round(progressData.percentage)}%] ${progressData.message}`);
        };

        try {
          let files: FileContent[] = [];
          try {
            files = JSON.parse(filesInput);
            if (!Array.isArray(files)) throw new Error("Input is not an array.");
          } catch (error) {
            throw new Error(`Invalid JSON input: ${error instanceof Error ? error.message : String(error)}`);
          }

          const rankedGraph = await analyzeProject({ files, onProgress, logLevel: 'debug' });
          const scn = generateScn(rankedGraph);
          setScnOutput(scn);
          logger.info('Analysis complete.');
        } catch (error) {
          const message = error instanceof Error ? error.message : String(error);
          logger.error('Analysis failed:', message);
        } finally {
          setIsLoading(false);
          setProgress(null);
          logger.setLogHandler(null);
        }
      }, [filesInput, isInitialized]);

      return (
        <div className="min-h-screen flex flex-col p-4 gap-4">
          <header className="flex-shrink-0 flex items-center justify-between">
            <h1 className="text-2xl font-bold">SCN-TS Web Demo</h1>
            <Button onClick={handleAnalyze} disabled={isLoading || !isInitialized} className="w-32 justify-center">
              {isLoading ? (
                <>
                  <Loader className="mr-2 h-4 w-4 animate-spin" />
                  <span>{progress ? `${Math.round(progress.percentage)}%` : 'Analyzing...'}</span>
                </>
              ) : (
                <>
                  <Play className="mr-2 h-4 w-4" />
                  <span>Analyze</span>
                </>
              )}
            </Button>
          </header>

          <main className="flex-grow grid grid-cols-1 lg:grid-cols-2 gap-4 h-[calc(100vh-150px)]">
            <Card className="flex flex-col">
              <CardHeader>
                <CardTitle>Input Files (JSON)</CardTitle>
              </CardHeader>
              <CardContent className="flex-grow">
                <Textarea
                  value={filesInput}
                  onChange={(e) => setFilesInput(e.currentTarget.value)}
                  className="h-full w-full font-mono text-xs"
                  placeholder="Paste an array of FileContent objects here..."
                />
              </CardContent>
            </Card>

            <Card className="flex flex-col overflow-hidden">
               <CardHeader>
                <CardTitle>Output (SCN)</CardTitle>
              </CardHeader>
              <CardContent className="flex-grow overflow-auto p-0">
                <pre className="text-xs whitespace-pre font-mono p-4 h-full w-full">
                  <code>
                    {scnOutput || (isLoading ? "Generating..." : "Output will appear here.")}
                  </code>
                </pre>
              </CardContent>
            </Card>
          </main>

          <footer className="flex-shrink-0 h-[150px]">
            <LogViewer logs={logs} />
          </footer>
        </div>
      );
    }


    export default App;
approved: true
