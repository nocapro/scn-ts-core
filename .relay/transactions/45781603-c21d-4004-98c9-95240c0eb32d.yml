uuid: 45781603-c21d-4004-98c9-95240c0eb32d
projectId: scn-ts-core
createdAt: '2025-09-05T00:36:21.660Z'
linesAdded: 19
linesRemoved: 2
gitCommitMsg: 'feat(web-demo): add copy button to output panel'
promptSummary: add a copy button for the output SCN
reasoning:
  - >-
    yo, check it. i'm adding a copy button to the output pane in the web demo.
    makes it way easier to grab the SCN output.
  - 'first, i''ll update `App.tsx` to handle the copy logic. this means:'
  - 1.  importing `Copy` and `Check` icons from `lucide-react`.
  - 2.  adding state to track if the content was just copied (`isCopied`).
  - 3.  creating a `handleCopy` function that uses the clipboard API.
  - >-
    4.  updating the JSX for the output header to include the new button and
    token count. it'll show a checkmark for a couple seconds after you click it.
    good ux right there.
  - >-
    this should be a straightforward change, all contained in `App.tsx`. let's
    get it.
operations:
  - type: write
    path: packages/scn-ts-web-demo/src/App.tsx
    content: >-
      --- packages/scn-ts-web-demo/src/App.tsx

      +++ packages/scn-ts-web-demo/src/App.tsx

      @@ -7,16 +7,17 @@
       import { Card, CardContent, CardHeader, CardTitle } from './components/ui/card';
       import { Textarea } from './components/ui/textarea';
       import LogViewer from './components/LogViewer';
      -import OutputOptions from './components/OutputOptions';

      -import { Play, Loader } from 'lucide-react';

      +import OutputOptions from './components/OutputOptions';

      +import { Play, Loader, Copy, Check } from 'lucide-react';
       import type { LogEntry, ProgressData, FormattingOptions } from './types';
       
       function App() {
         const [isInitialized, setIsInitialized] = useState(false);
         const [isLoading, setIsLoading] = useState(false);
         const [filesInput, setFilesInput] = useState(defaultFilesJSON);
         const [scnOutput, setScnOutput] = useState('');
         const [analysisResult, setAnalysisResult] = useState<SourceFile[] | null>(null);
      +  const [isCopied, setIsCopied] = useState(false);
         const [formattingOptions, setFormattingOptions] = useState<FormattingOptions>({
           showOutgoing: true,
           showIncoming: true,
      @@ -70,6 +71,17 @@
           }
         }, [analysisResult, formattingOptions]);
       
      +  const handleCopy = useCallback(() => {

      +    if (scnOutput) {

      +      navigator.clipboard.writeText(scnOutput).then(

      +        () => {

      +          setIsCopied(true);

      +          setTimeout(() => setIsCopied(false), 2000);

      +        }

      +      );

      +    }

      +  }, [scnOutput]);

      +
         const handleAnalyze = useCallback(async () => {
           if (!isInitialized) {
             setLogs(prev => [...prev, { level: 'warn', message: 'Parser not ready.', timestamp: Date.now() }]);
      @@ -155,8 +167,15 @@
             {/* Main Content Area */}
             <main className="flex-grow flex flex-col overflow-hidden">
               <div className="flex justify-between items-center p-4 border-b flex-shrink-0">
      -          <CardTitle>Output (SCN)</CardTitle>

      -          <span className="text-sm font-normal text-muted-foreground
      tabular-nums">{tokenCounts.output.toLocaleString()} tokens</span>

      +          <CardTitle>Output (SCN)</CardTitle>

      +          <div className="flex items-center gap-4">

      +            <span className="text-sm font-normal text-muted-foreground
      tabular-nums">{tokenCounts.output.toLocaleString()} tokens</span>

      +            <Button variant="ghost" size="icon" onClick={handleCopy}
      disabled={!scnOutput} title="Copy to clipboard">

      +              {isCopied ? <Check className="h-4 w-4 text-green-500" /> :
      <Copy className="h-4 w-4" />}

      +            </Button>

      +          </div>
               </div>
               <div className="p-4 flex-grow overflow-auto font-mono text-xs">
                 <pre className="whitespace-pre-wrap">
    patchStrategy: new-unified
snapshot:
  packages/scn-ts-web-demo/src/App.tsx: >
    import { useState, useEffect, useCallback } from 'react';

    import { get_encoding, type Tiktoken } from 'tiktoken';

    import {
      initializeParser,
      logger,
      analyzeProject,
      generateScn,
    } from '../../../index';

    import type { FileContent, LogHandler, SourceFile } from '../../../index';

    import { defaultFilesJSON } from './default-files';

    import { Button } from './components/ui/button';

    import { Card, CardContent, CardHeader, CardTitle } from
    './components/ui/card';

    import { Textarea } from './components/ui/textarea';

    import LogViewer from './components/LogViewer';

    import OutputOptions from './components/OutputOptions';

    import { Play, Loader } from 'lucide-react';

    import type { LogEntry, ProgressData, FormattingOptions } from './types';


    function App() {
      const [isInitialized, setIsInitialized] = useState(false);
      const [isLoading, setIsLoading] = useState(false);
      const [filesInput, setFilesInput] = useState(defaultFilesJSON);
      const [scnOutput, setScnOutput] = useState('');
      const [analysisResult, setAnalysisResult] = useState<SourceFile[] | null>(null);
      const [formattingOptions, setFormattingOptions] = useState<FormattingOptions>({
        showOutgoing: true,
        showIncoming: true,
        showIcons: true,
        showExportedIndicator: true,
        showPrivateIndicator: true,
        showModifiers: true,
        showTags: true,
        showSymbolIds: true,
        groupMembers: true,
        displayFilters: {},
      });
      const [progress, setProgress] = useState<ProgressData | null>(null);
      const [logs, setLogs] = useState<LogEntry[]>([]);
      const [encoder, setEncoder] = useState<Tiktoken | null>(null);
      const [tokenCounts, setTokenCounts] = useState({ input: 0, output: 0 });

      useEffect(() => {
        const init = async () => {
          try {
            await initializeParser({ wasmBaseUrl: '/wasm/' });
            const enc = get_encoding("cl100k_base");
            setEncoder(enc);
            setIsInitialized(true);
            setLogs(prev => [...prev, { level: 'info', message: 'Parser and tokenizer initialized.', timestamp: Date.now() }]);
          } catch (error) {
            const message = error instanceof Error ? error.message : String(error);
            setLogs(prev => [...prev, { level: 'error', message: `Failed to initialize: ${message}`, timestamp: Date.now() }]);
          }
        };
        init();
      }, []);

      useEffect(() => {
        if (!encoder) return;
        try {
          const inputTokens = encoder.encode(filesInput).length;
          const outputTokens = encoder.encode(scnOutput).length;
          setTokenCounts({ input: inputTokens, output: outputTokens });
        } catch (e) {
          console.error("Tokenization error:", e);
          setTokenCounts({ input: 0, output: 0 });
        }
      }, [filesInput, scnOutput, encoder]);

      useEffect(() => {
        if (analysisResult) {
          const scn = generateScn(analysisResult, formattingOptions);
          setScnOutput(scn);
        }
      }, [analysisResult, formattingOptions]);

      const handleAnalyze = useCallback(async () => {
        if (!isInitialized) {
          setLogs(prev => [...prev, { level: 'warn', message: 'Parser not ready.', timestamp: Date.now() }]);
          return;
        }

        setIsLoading(true);
        setLogs([]);
        setScnOutput('');
        setAnalysisResult(null);
        setProgress(null);

        const logHandler: LogHandler = (level, ...args) => {
          const message = args.map(arg => typeof arg === 'object' ? JSON.stringify(arg) : String(arg)).join(' ');
          setLogs(prev => [...prev, { level, message, timestamp: Date.now() }]);
        };
        logger.setLogHandler(logHandler);
        logger.setLevel('debug');

        const onProgress = (progressData: ProgressData) => {
          setProgress(progressData);
          logger.info(`[${Math.round(progressData.percentage)}%] ${progressData.message}`);
        };

        try {
          let files: FileContent[] = [];
          try {
            files = JSON.parse(filesInput);
            if (!Array.isArray(files)) throw new Error("Input is not an array.");
          } catch (error) {
            throw new Error(`Invalid JSON input: ${error instanceof Error ? error.message : String(error)}`);
          }

          const rankedGraph = await analyzeProject({ files, onProgress, logLevel: 'debug' });
          setAnalysisResult(rankedGraph);
          logger.info('Analysis complete.');
        } catch (error) {
          const message = error instanceof Error ? error.message : String(error);
          logger.error('Analysis failed:', message);
        } finally {
          setIsLoading(false);
          setProgress(null);
          logger.setLogHandler(null);
        }
      }, [filesInput, isInitialized]);

      return (
        <div className="h-screen w-screen flex bg-background text-foreground">
          {/* Sidebar */}
          <aside className="w-[30rem] max-w-[40%] flex-shrink-0 flex flex-col border-r">
            <div className="flex-shrink-0 flex items-center justify-between p-4 border-b">
              <h1 className="text-xl font-bold tracking-tight">SCN-TS Web Demo</h1>
              <Button onClick={handleAnalyze} disabled={isLoading || !isInitialized} className="w-32 justify-center">
                {isLoading ? (
                  <>
                    <Loader className="mr-2 h-4 w-4 animate-spin" />
                    <span>{progress ? `${Math.round(progress.percentage)}%` : 'Analyzing...'}</span>
                  </>
                ) : (
                  <>
                    <Play className="mr-2 h-4 w-4" />
                    <span>Analyze</span>
                  </>
                )}
              </Button>
            </div>

            <div className="flex-grow overflow-y-auto p-4 flex flex-col gap-4">
              <Card className="flex flex-col min-h-96">
                <CardHeader>
                  <CardTitle className="flex justify-between items-center">
                    <span>Input Files (JSON)</span>
                    <span className="text-sm font-normal text-muted-foreground">{tokenCounts.input.toLocaleString()} tokens</span>
                  </CardTitle>
                </CardHeader>
                <CardContent className="flex-grow">
                  <Textarea
                    value={filesInput}
                    onChange={(e) => setFilesInput(e.currentTarget.value)}
                    className="h-full w-full font-mono text-xs resize-none"
                    placeholder="Paste an array of FileContent objects here..."
                  />
                </CardContent>
              </Card>
              <OutputOptions options={formattingOptions} setOptions={setFormattingOptions} />
              <div className="min-h-60">
                <LogViewer logs={logs} />
              </div>
            </div>
          </aside>

          {/* Main Content Area */}
          <main className="flex-grow flex flex-col overflow-hidden">
            <div className="flex justify-between items-center p-4 border-b flex-shrink-0">
              <CardTitle>Output (SCN)</CardTitle>
              <span className="text-sm font-normal text-muted-foreground tabular-nums">{tokenCounts.output.toLocaleString()} tokens</span>
            </div>
            <div className="p-4 flex-grow overflow-auto font-mono text-xs">
              <pre className="whitespace-pre-wrap">
                {scnOutput || (isLoading ? "Generating..." : "Output will appear here.")}
              </pre>
            </div>
          </main>
        </div>
      );
    }


    export default App;
approved: true
